<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ™ Magickal Mortalz Coven</title>
    
    <!-- ğŸ”® MYSTICAL FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Philosopher:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- ğŸ¨ CSS INCLUDE -->
    <?!= include('css'); ?>
</head>
<body>
    
    <!-- ğŸ”„ LOADING OVERLAY -->
    <div id="loading-overlay" class="loading-overlay active">
        <div class="loading-content">
            <div class="loading-spinner">â­</div>
            <p>Summoning the Circle...</p>
        </div>
    </div>

    <!-- ğŸ“‘ SIDEBAR NAVIGATION -->
    <nav class="sidebar" id="sidebar">
        <div class="brand">
            <i class="fa-solid fa-moon"></i>
            <span>Magickal Mortalz</span>
        </div>
        
        <!-- ğŸ‘¤ User Profile Mini -->
        <div class="user-mini" id="user-mini">
            <div class="user-avatar" id="user-avatar">ğŸ§™â€â™‚ï¸</div>
            <div class="user-info">
                <span class="user-name" id="user-craft-name">Loading...</span>
                <span class="user-degree" id="user-degree">Neophyte</span>
            </div>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a class="nav-link active" data-section="dashboard" onclick="showSection('dashboard', this)">
                    <i class="fa-solid fa-house-chimney"></i> Covenstead
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="curriculum" onclick="showSection('curriculum', this)">
                    <i class="fa-solid fa-book-journal-whills"></i> The Path
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="attendance" onclick="showSection('attendance', this)">
                    <i class="fa-solid fa-calendar-moon"></i> Wheel of Year
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="grimoire" onclick="showSection('grimoire', this)">
                    <i class="fa-solid fa-scroll"></i> Grimoire
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="campus" onclick="showSection('campus', this)">
                    <i class="fa-solid fa-school"></i> Campus
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-section="profile" onclick="showSection('profile', this)">
                    <i class="fa-solid fa-user-astronaut"></i> My Spirit
                </a>
            </li>
        </ul>
        
        <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()">
            <i class="fa-solid fa-bars"></i>
        </button>
    </nav>

    <!-- ğŸ“± MAIN CONTENT AREA -->
    <main class="main-content" id="main-content">
        
        <!-- ğŸ  DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <div class="header">
                <h1>Blessed Be, Witch! <span id="moon-phase-display">ğŸŒ•</span></h1>
                <p>Magickal Mortalz Coven â€¢ South Florida's Premiere Brotherhood</p>
            </div>
            
            <!-- ğŸ“Š Stats Cards -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ”¥</div>
                    <div class="stat-info">
                        <span class="stat-value" id="stat-progress">0%</span>
                        <span class="stat-label">Path Progress</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸƒ</div>
                    <div class="stat-info">
                        <span class="stat-value" id="stat-sabbats">0/8</span>
                        <span class="stat-label">Sabbats Attended</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“œ</div>
                    <div class="stat-info">
                        <span class="stat-value" id="stat-grimoire">0</span>
                        <span class="stat-label">Grimoire Entries</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸŒ•</div>
                    <div class="stat-info">
                        <span class="stat-value" id="stat-esbats">0</span>
                        <span class="stat-label">Moon Rites</span>
                    </div>
                </div>
            </div>
            
            <!-- ğŸŒ™ Upcoming -->
            <div class="upcoming-section">
                <h2>ğŸŒ™ Turning of the Wheel</h2>
                <div class="upcoming-grid" id="upcoming-sabbats">
                    <div class="loading-placeholder">Consulting the stars...</div>
                </div>
            </div>
            
            <div class="grid-container">
                <div class="card" onclick="showSection('curriculum', document.querySelector('[data-section=curriculum]'))">
                    <div class="card-icon">ğŸ“</div>
                    <h3>Your Sacred Path</h3>
                    <p>Track your initiatory journey through the degrees.</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="dashboard-progress-bar" style="width: 0%"></div>
                    </div>
                    <span class="tag" id="dashboard-degree-tag">Neophyte</span>
                </div>
                <div class="card" onclick="showSection('grimoire', document.querySelector('[data-section=grimoire]'))">
                    <div class="card-icon">ğŸ”®</div>
                    <h3>Book of Shadows</h3>
                    <p>Inscribe your spells, dreams, and rituals.</p>
                    <span class="tag">Private</span>
                </div>
                <div class="card" onclick="showSection('campus', document.querySelector('[data-section=campus]'))">
                    <div class="card-icon">ğŸ³ï¸â€ğŸŒˆ</div>
                    <h3>The Brotherhood</h3>
                    <p>Connect with Elders and brothers in the craft.</p>
                    <span class="tag">Online Campus</span>
                </div>
            </div>
        </section>

        <!-- ğŸ“š CURRICULUM SECTION -->
        <section id="curriculum" class="section">
            <div class="header">
                <h1>The 4-Year Path ğŸ“œ</h1>
                <p>From Neophyte to High Priesthood</p>
            </div>
            
            <!-- ğŸ“Š Overall Progress -->
            <div class="card curriculum-overview" style="margin-bottom: 2rem;">
                <h3>Your Initiation Progress</h3>
                <div class="progress-bar-container" style="height: 24px; margin-bottom: 1rem;">
                    <div class="progress-bar" id="curriculum-overall-progress" style="width: 0%"></div>
                </div>
                <div style="display: flex; gap: 2rem; color: var(--text-light);">
                    <span><strong id="modules-completed" style="color: var(--primary);">0</strong> Mastered</span>
                    <span><strong id="modules-in-progress" style="color: var(--accent);">0</strong> Studying</span>
                    <span><strong id="modules-remaining" style="color: var(--text-muted);">0</strong> Awaiting</span>
                </div>
            </div>
            
            <!-- ğŸ“ Year Cards [RESTORED] -->
            <div class="grid-container">
                <div class="card year-card" data-year="1" onclick="openYearModal(1)">
                    <div class="card-icon">ğŸŒ±</div>
                    <h3>Year 1: Neophyte</h3>
                    <p>Foundations & Tools. Basic energy work and history.</p>
                    <div class="progress-bar-container"><div class="progress-bar" id="year1-progress" style="width: 0%"></div></div>
                    <span class="tag">Beginner</span>
                </div>
                <div class="card year-card" data-year="2" onclick="openYearModal(2)">
                    <div class="card-icon">ğŸ›¡ï¸</div>
                    <h3>Year 2: 1st Degree</h3>
                    <p>Protection & Psychic Defense. Mastering the shield and sword.</p>
                    <div class="progress-bar-container"><div class="progress-bar" id="year2-progress" style="width: 0%"></div></div>
                    <span class="tag">Intermediate</span>
                </div>
                <div class="card year-card" data-year="3" onclick="openYearModal(3)">
                    <div class="card-icon">ğŸŒ˜</div>
                    <h3>Year 3: 2nd Degree</h3>
                    <p>Goddess Focus. Lunar mysteries and deep emotional work.</p>
                    <div class="progress-bar-container"><div class="progress-bar" id="year3-progress" style="width: 0%"></div></div>
                    <span class="tag">Advanced</span>
                </div>
                <div class="card year-card" data-year="4" onclick="openYearModal(4)">
                    <div class="card-icon">â˜€ï¸</div>
                    <h3>Year 4: 3rd Degree</h3>
                    <p>God Focus. Solar power, leadership, and high magic.</p>
                    <div class="progress-bar-container"><div class="progress-bar" id="year4-progress" style="width: 0%"></div></div>
                    <span class="tag">Expert</span>
                </div>
            </div>
        </section>

        <!-- ğŸ“… ATTENDANCE SECTION -->
        <section id="attendance" class="section">
            <div class="header">
                <h1>Wheel of the Year ğŸ¡</h1>
                <p>Tracking your journey through the seasons.</p>
            </div>
            
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon">ğŸƒ</div>
                    <div class="stat-info">
                        <span class="stat-value" id="att-sabbat-count">0/8</span>
                        <span class="stat-label">Great Sabbats</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸŒ•</div>
                    <div class="stat-info">
                        <span class="stat-value" id="att-esbat-count">0</span>
                        <span class="stat-label">Esbat Rites</span>
                    </div>
                </div>
            </div>
            
            <div class="wheel-section">
                <h2>The Eight Sabbats</h2>
                <div class="sabbat-grid" id="sabbat-grid">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <div class="card records-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>ğŸ“‹ Ritual Log</h2>
                    <button class="btn-primary" onclick="openRecordAttendanceModal()">
                        <i class="fa-solid fa-plus"></i> Record Rite
                    </button>
                </div>
                <table style="width: 100%; text-align: left; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); color: var(--text-muted);">
                            <th style="padding: 1rem;">Event</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="attendance-tbody"></tbody>
                </table>
            </div>
        </section>

        <!-- ğŸ“œ GRIMOIRE SECTION -->
        <section id="grimoire" class="section">
            <div class="header">
                <h1>Book of Shadows ğŸ•¯ï¸</h1>
                <p>Your personal collection of spells and wisdom.</p>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <input type="text" id="grimoire-search" placeholder="ğŸ” Search your spells..." oninput="filterGrimoireEntries()" style="flex: 1;">
                <select id="grimoire-category-filter" onchange="filterGrimoireByCategory()">
                    <option value="all">ğŸ”® All Magic</option>
                </select>
                <button class="btn-primary" onclick="openNewEntryModal()">
                    <i class="fa-solid fa-quill"></i> New Page
                </button>
            </div>
            
            <div class="category-stats" id="grimoire-category-stats" style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;"></div>
            
            <div class="grimoire-grid" id="grimoire-entries">
                <!-- Entries -->
            </div>
            
            <!-- Coven Rituals -->
            <div class="coven-rituals" style="margin-top: 3rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 2rem;">
                <h2>â­• Coven Rites</h2>
                <div class="grid-container">
                    <div class="card" onclick="openRitualModal('circle')">
                        <div class="card-icon">â­•</div>
                        <h3>The Circle</h3>
                        <p>Casting & Closing</p>
                    </div>
                    <div class="card" onclick="openRitualModal('air')">
                        <div class="card-icon">ğŸŒ¬ï¸</div>
                        <h3>Air</h3>
                        <p>Watchtower of the East</p>
                    </div>
                    <div class="card" onclick="openRitualModal('fire')">
                        <div class="card-icon">ğŸ”¥</div>
                        <h3>Fire</h3>
                        <p>Watchtower of the South</p>
                    </div>
                    <div class="card" onclick="openRitualModal('water')">
                        <div class="card-icon">ğŸ’§</div>
                        <h3>Water</h3>
                        <p>Watchtower of the West</p>
                    </div>
                    <div class="card" onclick="openRitualModal('earth')">
                        <div class="card-icon">ğŸŒ¿</div>
                        <h3>Earth</h3>
                        <p>Watchtower of the North</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ğŸ« CAMPUS SECTION [RESTORED] -->
        <section id="campus" class="section">
            <div class="header">
                <h1>Online Campus ğŸ«</h1>
                <p>Magickal education & brotherhood.</p>
            </div>
            
            <div class="card mission-card" style="margin-bottom: 2rem;">
                <h3>Our Coven's Mission</h3>
                <p>We strive to create a safe, magickal space for brotherhood, learning, and spiritual growth. Join us for weekly classes on Tarot, Crystals, and Deity work. Our coven celebrates diversity, embraces LGBTQ+ practitioners, and honors both traditional Wiccan practices and modern innovations.</p>
            </div>
            
            <h2 class="section-title" style="margin-top: 2rem;">ğŸ‘¨â€ğŸ« Our Elders</h2>
            <div class="grid-container">
                <div class="card elder-card">
                    <div class="elder-avatar">ğŸ§™â€â™‚ï¸</div>
                    <h3>Elder Rowan</h3>
                    <p class="elder-specialty">Herbology & Traditional Witchcraft</p>
                    <p>With over 20 years of practice, Elder Rowan guides initiates through the green path of plant magick and traditional British Witchcraft.</p>
                </div>
                <div class="card elder-card">
                    <div class="elder-avatar">ğŸ”®</div>
                    <h3>Sage Phoenix</h3>
                    <p class="elder-specialty">Divination, Tarot & Astral Travel</p>
                    <p>A master of the divinatory arts, Sage Phoenix teaches the mysteries of the Tarot, pendulum work, and astral projection techniques.</p>
                </div>
                <div class="card elder-card">
                    <div class="elder-avatar">â˜€ï¸</div>
                    <h3>High Priest Erik</h3>
                    <p class="elder-specialty">Founder & Coven Leader</p>
                    <p>As the founder of Magickal Mortalz, High Priest Erik brings together gay Wiccans from across South Florida to celebrate the Craft.</p>
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 2rem;">ğŸ“… Weekly Schedule</h2>
            <div class="schedule-grid">
                <div class="card schedule-item">
                    <div class="schedule-day">Monday</div>
                    <div class="schedule-event">ğŸ§˜ Meditation Circle</div>
                    <div class="schedule-time">7:00 PM EST</div>
                </div>
                <div class="card schedule-item">
                    <div class="schedule-day">Wednesday</div>
                    <div class="schedule-event">ğŸ´ Tarot Study Group</div>
                    <div class="schedule-time">7:00 PM EST</div>
                </div>
                <div class="card schedule-item">
                    <div class="schedule-day">Friday</div>
                    <div class="schedule-event">ğŸ’ Crystal Workshop</div>
                    <div class="schedule-time">7:00 PM EST</div>
                </div>
                <div class="card schedule-item full-moon">
                    <div class="schedule-day" style="color:white">Full Moon</div>
                    <div class="schedule-event">ğŸŒ• Esbat Ritual</div>
                    <div class="schedule-time" style="color:rgba(255,255,255,0.8)">9:00 PM EST</div>
                </div>
            </div>
            
            <!-- Social Links [RESTORED] -->
            <h2 class="section-title" style="margin-top: 2rem;">ğŸŒ Connect With Us</h2>
            <div class="card">
                 <p>Visit our <a href="https://magickal-mortalz-hnh8x4e.gamma.site/" target="_blank" style="color:var(--accent)">Public Website</a> or join our <a href="https://www.facebook.com/groups/magickalmortalzcoven/" target="_blank" style="color:var(--secondary)">Facebook Group</a>.</p>
            </div>
        </section>

        <!-- ğŸ‘¤ PROFILE SECTION -->
        <section id="profile" class="section">
            <div class="card profile-header" style="display:flex; gap:2rem; align-items:center;">
                <div class="user-avatar" id="profile-avatar" style="width: 100px; height: 100px; font-size: 3rem;">ğŸ§™â€â™‚ï¸</div>
                <div class="profile-info" style="flex:1">
                    <h2 id="profile-craft-name">Craft Name</h2>
                    <p id="profile-degree" style="color: var(--accent); font-weight:600;">Neophyte</p>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">Member since: <span id="profile-join-date">Loading...</span></p>
                </div>
                <button class="btn-secondary" onclick="openEditProfileModal()">âœï¸ Edit Profile</button>
            </div>
            
            <div class="grid-container" style="margin-top:1.5rem">
                <div class="card">
                    <h3>Magickal Stats</h3>
                    <div style="display: flex; justify-content: space-around; text-align: center; margin-top: 1rem;">
                        <div>
                            <div class="stat-value" id="journey-modules">0</div>
                            <div class="stat-label">Modules</div>
                        </div>
                        <div>
                            <div class="stat-value" id="journey-sabbats">0</div>
                            <div class="stat-label">Sabbats</div>
                        </div>
                        <div>
                            <div class="stat-value" id="journey-entries">0</div>
                            <div class="stat-label">Spells</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Personal Info</h3>
                    <p><strong>Email:</strong> <span id="profile-email">...</span></p>
                    <p><strong>Real Name:</strong> <span id="profile-real-name">Hidden</span></p>
                </div>
                
                <div class="card">
                    <h3>Bio</h3>
                    <p id="profile-bio" style="font-style: italic;">No story written yet...</p>
                </div>
            </div>
        </section>

    </main>

    <!-- ğŸªŸ MODALS -->
    <div id="modal-year" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modal-year')">âœ•</button>
            <div id="year-modal-content"></div>
        </div>
    </div>
    
    <div id="modal-new-entry" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modal-new-entry')">âœ•</button>
            <h2>ğŸ–‹ï¸ Inscribe New Spell</h2>
            <form id="new-entry-form" onsubmit="submitNewEntry(event)">
                <div class="form-group"><label>Title</label><input type="text" id="entry-title" required></div>
                <div class="form-group"><label>Category</label><select id="entry-category" required></select></div>
                <div class="form-group"><label>Content</label><textarea id="entry-content" rows="6" required></textarea></div>
                <div class="form-group"><label>Tags</label><input type="text" id="entry-tags"></div>
                <div class="form-group"><label><input type="checkbox" id="entry-private" checked> Keep Secret ğŸ”’</label></div>
                <button type="submit" class="btn-primary">Save to Grimoire</button>
            </form>
        </div>
    </div>

    <div id="modal-view-entry" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modal-view-entry')">âœ•</button>
            <div id="view-entry-content"></div>
        </div>
    </div>

    <div id="modal-record-attendance" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modal-record-attendance')">âœ•</button>
            <h2>ğŸ“ Record Ritual</h2>
            <form id="attendance-form" onsubmit="submitAttendance(event)">
                <div class="form-group"><label>Event Type</label><select id="att-type"><option value="Sabbat">Sabbat</option><option value="Esbat">Esbat</option><option value="Class">Class</option></select></div>
                <div class="form-group"><label>Event Name</label><input type="text" id="att-name" required></div>
                <div class="form-group"><label>Date</label><input type="date" id="att-date" required></div>
                <div class="form-group"><label>Notes</label><textarea id="att-notes" rows="3"></textarea></div>
                <div class="form-group"><label><input type="checkbox" id="att-attended" checked> I attended</label></div>
                <button type="submit" class="btn-primary">Record</button>
            </form>
        </div>
    </div>

    <div id="modal-ritual" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modal-ritual')">âœ•</button>
            <div id="ritual-modal-content"></div>
        </div>
    </div>
    
    <div id="modal-edit-profile" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modal-edit-profile')">âœ•</button>
            <h2>âœï¸ Edit Spirit Identity</h2>
            <form id="edit-profile-form" onsubmit="submitProfileEdit(event)">
                <div class="form-group"><label>Craft Name</label><input type="text" id="edit-craft-name" required></div>
                <div class="form-group"><label>Avatar</label><input type="text" id="edit-avatar"></div>
                <div class="form-group"><label>Bio</label><textarea id="edit-bio" rows="4"></textarea></div>
                <button type="submit" class="btn-primary">Update Profile</button>
            </form>
        </div>
    </div>
    
    <div id="toast-container" class="toast-container"></div>

    <!-- ğŸ“œ JAVASCRIPT INCLUDE -->
    <?!= include('js'); ?>
    
</body>
</html>